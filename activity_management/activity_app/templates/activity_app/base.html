{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'activity_app/style.css' %}">
</head>
<body>
    <!-- Sidebar -->
    {% include "activity_app/includes/navbar.html" %}

        <div class="container">
        <div class="header">
            <h1>Activity Management</h1>
            <a href="{% url "task_create" %}" class="add-btn">Add a New Task</a>
        </div>

        {% if page_obj %}
        <table>
            <thead>
                <tr>
                    <th>S.NO.</th>
                    <th>Task ID</th>
                    <th>Title</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                {% for task in page_obj %}
                <tr>
                    <td>{{ forloop.counter|add:page_obj.start_index|add:"-1" }}</td>
                    <td class="task-id" onclick="togglePopup(event, {{ task.id }})" 
                        style="color: blue; text-decoration: underline; cursor: pointer; position: relative;">
                        {{ task.task_id }}
                        <div class="popup-menu" id="popup-{{ task.id }}">
                            <a href="#" class="details">Details</a>
                            <a href="{% url "task_edit" task.id %}" class="edit">Edit</a>
                            <a href="{% url "task_delete" task.id %}" class="delete" onclick="return confirm('Are you sure you want to delete this task?');">Delete</a>
                        </div>
                    </td>
                    <td>{{ task.title }}</td>
                    <td>{{ task.description|truncatewords:15|default:"No description" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>



        <!-- Pagination -->
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; First</a>
                <a href="?page={{ page_obj.previous_page_number }}">&lsaquo; Prev</a>
            {% else %}
                <span class="disabled">&laquo; First</span>
                <span class="disabled">&lsaquo; Prev</span>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <span class="current">{{ num }}</span>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a href="?page={{ num }}">{{ num }}</a>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">Next &rsaquo;</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">Last &raquo;</a>
            {% else %}
                <span class="disabled">Next &rsaquo;</span>
                <span class="disabled">Last &raquo;</span>
            {% endif %}
        </div>
        {% else %}
        <div class="no-tasks">
            <p>No tasks found. Click "Add a New Task" to create one.</p>
        </div>
        {% endif %}
    </div>

    <script src="{% static 'activity_app/script.js' %}"></script>
</body>
</html>